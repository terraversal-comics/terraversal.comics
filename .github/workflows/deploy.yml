name: Notion to GitHub Pages

on:
ย push:
ย ย branches: ["main"]
ย workflow_dispatch:

permissions:
ย contents: write
ย pages: write
ย id-token: write

jobs:
ย build:
ย ย runs-on: ubuntu-latest

ย ย steps:
ย ย ย - name: โฌ๏ธ Checkout repository
ย ย ย ย uses: actions/checkout@v4
ย ย ย ย with:
ย ย ย ย ย fetch-depth: 0

ย ย ย - name: โ๏ธ Setup Node.js
ย ย ย ย uses: actions/setup-node@v4
ย ย ย ย with:
ย ย ย ย ย node-version: '20'

ย ย ย - name: ๐พ Install dos2unix
ย ย ย ย run: sudo apt-get update && sudo apt-get install -y dos2unix

ย ย ย - name: ๐งน Fix Line Endings on script.js
ย ย ย ย run: dos2unix script.js

ย ย ย - name: ๐ Install Dependencies and Fetch Notion Data
ย ย ย ย run: |
ย ย ย ย ย npm install
ย ย ย ย ย npm start
ย ย ย ย env:
ย ย ย ย ย NOTION_SECRET: ${{ secrets.NOTION_SECRET }}

ย ย ย - name: โ๏ธ Setup Hugo
ย ย ย ย uses: peaceiris/actions-hugo@v3
ย ย ย ย with:
ย ย ย ย ย hugo-version: 'latest'
ย ย ย ย ย extended: true

ย ย ย - name: ๐๏ธ Build the Website
ย ย ย ย run: hugo -s . --config config.toml --baseURL "https://terraversal-comics.github.io/terraversal.comics/"

ย ย ย - name: ๐ฆ Setup Pages
ย ย ย ย id: pages
ย ย ย ย uses: actions/configure-pages@v5

ย ย ย - name: โฌ๏ธ Upload artifact
ย ย ย ย uses: actions/upload-pages-artifact@v3
ย ย ย ย with:
ย ย ย ย ย path: './public' # <--- Reverted to the correct path here

ย deploy:
ย ย environment:
ย ย ย name: github-pages
ย ย ย url: ${{ steps.deployment.outputs.page_url }}
ย ย runs-on: ubuntu-latest
ย ย needs: build
ย ย steps:
ย ย ย - name: ๐ Deploy to GitHub Pages
ย ย ย ย id: deployment
ย ย ย ย uses: actions/deploy-pages@v4
